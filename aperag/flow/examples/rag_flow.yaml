name: "RAG Knowledge Base Flow"
description: "A typical RAG flow with parallel retrieval and reranking"
version: "1.0.0"

# Global variable definitions
global_variables:
  - name: "query"
    type: "string"
    description: "User's question or query"

# Node definitions
nodes:
  # Vector search node
  - id: "vector_search-1715078400"
    type: "vector_search"
    name: "Vector Search"
    vars:
      - name: "top_k"
        value: 5
      - name: "similarity_threshold"
        value: 0.7
      - name: "query"
        source_type: "global"
        global_var: "query"

  # Keyword search node
  - id: "keyword_search-1715078400"
    type: "keyword_search"
    name: "Keyword Search"
    vars:
      - name: "query"
        source_type: "global"
        global_var: "query"

  # Merge node
  - id: "merge-1715078400"
    type: "merge"
    name: "Merge Results"
    vars:
      - name: "merge_strategy"
        value: "union"
      - name: "deduplicate"
        value: true
      - name: "vector_search_docs"
        source_type: "dynamic"
        ref_node: "vector_search-1715078400"
        ref_field: "vector_search_docs"
      - name: "keyword_search_docs"
        source_type: "dynamic"
        ref_node: "keyword_search-1715078400"
        ref_field: "keyword_search_docs"

  # Rerank node
  - id: "rerank-1715078400"
    type: "rerank"
    name: "Rerank Results"
    vars:
      - name: "model"
        value: "bge-reranker"
      - name: "docs"
        source_type: "dynamic"
        ref_node: "merge-1715078400"
        ref_field: "docs"

  # LLM generation node
  - id: "llm-1715078400"
    type: "llm"
    name: "LLM Generation"
    vars:
      - name: "model"
        value: "gpt-3.5-turbo"
      - name: "temperature"
        value: 0.7
      - name: "max_tokens"
        value: 1000
      - name: "query"
        source_type: "global"
        global_var: "query"
      - name: "docs"
        source_type: "dynamic"
        ref_node: "rerank-1715078400"
        ref_field: "docs"

# Edge definitions (connections between nodes)
edges:
  # Vector search to merge
  - source: "vector_search-1715078400"
    target: "merge-1715078400"
    source_field: "vector_search_docs"
    target_field: "vector_search_docs"

  # Keyword search to merge
  - source: "keyword_search-1715078400"
    target: "merge-1715078400"
    source_field: "keyword_search_docs"
    target_field: "keyword_search_docs"

  # Merge to rerank
  - source: "merge-1715078400"
    target: "rerank-1715078400"
    source_field: "docs"
    target_field: "docs"

  # Rerank to LLM
  - source: "rerank-1715078400"
    target: "llm-1715078400"
    source_field: "docs"
    target_field: "context"

# Execution configuration
execution:
  timeout: 300  # Overall timeout (seconds)
  retry:
    max_attempts: 3
    delay: 5
  error_handling:
    strategy: "stop_on_error"  # or "continue_on_error"
    notification:
      email: ["admin@example.com"]