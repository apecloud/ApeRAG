"""empty message

Revision ID: 2768dfee8bbc
Revises: 12ea6d2bf365
Create Date: 2025-06-21 00:28:36.443046

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision: str = '2768dfee8bbc'
down_revision: Union[str, None] = '12ea6d2bf365'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('audit_log',
    sa.Column('id', sa.String(length=36), nullable=False),
    sa.Column('user_id', sa.String(length=36), nullable=True, comment='User ID'),
    sa.Column('username', sa.String(length=255), nullable=True, comment='Username'),
    sa.Column('resource_type', sa.Enum('collection', 'document', 'bot', 'chat', 'message', 'api_key', 'llm_provider', 'llm_provider_model', 'model_service_provider', 'user', 'config', 'invitation', 'auth', 'chat_completion', 'search', 'llm', 'flow', 'system', name='auditresource'), nullable=True, comment='Resource type'),
    sa.Column('resource_id', sa.String(length=255), nullable=True, comment='Resource ID (extracted at query time)'),
    sa.Column('api_name', sa.String(length=255), nullable=False, comment='API operation name'),
    sa.Column('http_method', sa.String(length=10), nullable=False, comment='HTTP method (POST, PUT, DELETE)'),
    sa.Column('path', sa.String(length=512), nullable=False, comment='API path'),
    sa.Column('status_code', sa.Integer(), nullable=True, comment='HTTP status code'),
    sa.Column('request_data', sa.Text(), nullable=True, comment='Request data (JSON)'),
    sa.Column('response_data', sa.Text(), nullable=True, comment='Response data (JSON)'),
    sa.Column('error_message', sa.Text(), nullable=True, comment='Error message if failed'),
    sa.Column('ip_address', sa.String(length=45), nullable=True, comment='Client IP address'),
    sa.Column('user_agent', sa.String(length=500), nullable=True, comment='User agent string'),
    sa.Column('request_id', sa.String(length=255), nullable=False, comment='Request ID for tracking'),
    sa.Column('start_time', sa.BigInteger(), nullable=False, comment='Request start time (milliseconds since epoch)'),
    sa.Column('end_time', sa.BigInteger(), nullable=True, comment='Request end time (milliseconds since epoch)'),
    sa.Column('gmt_created', sa.DateTime(timezone=True), nullable=False, comment='Created time'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('idx_audit_api_name', 'audit_log', ['api_name'], unique=False)
    op.create_index('idx_audit_gmt_created', 'audit_log', ['gmt_created'], unique=False)
    op.create_index('idx_audit_http_method', 'audit_log', ['http_method'], unique=False)
    op.create_index('idx_audit_request_id', 'audit_log', ['request_id'], unique=False)
    op.create_index('idx_audit_resource_id', 'audit_log', ['resource_id'], unique=False)
    op.create_index('idx_audit_resource_type', 'audit_log', ['resource_type'], unique=False)
    op.create_index('idx_audit_start_time', 'audit_log', ['start_time'], unique=False)
    op.create_index('idx_audit_status_code', 'audit_log', ['status_code'], unique=False)
    op.create_index('idx_audit_user_id', 'audit_log', ['user_id'], unique=False)
    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index('idx_audit_user_id', table_name='audit_log')
    op.drop_index('idx_audit_status_code', table_name='audit_log')
    op.drop_index('idx_audit_start_time', table_name='audit_log')
    op.drop_index('idx_audit_resource_type', table_name='audit_log')
    op.drop_index('idx_audit_resource_id', table_name='audit_log')
    op.drop_index('idx_audit_request_id', table_name='audit_log')
    op.drop_index('idx_audit_http_method', table_name='audit_log')
    op.drop_index('idx_audit_gmt_created', table_name='audit_log')
    op.drop_index('idx_audit_api_name', table_name='audit_log')
    op.drop_table('audit_log')
    # ### end Alembic commands ###
